<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>NBA Betting – Cards</title>
  <link rel="stylesheet" href="/web/styles.css" />
</head>
<body>
  <header>
    <div class="container header-inner">
      <h1>NBA Betting – Cards</h1>
      <form id="controls" onsubmit="return false;">
        <label>Date: <input type="date" id="datePicker" /></label>
        <button type="button" id="applyBtn" class="btn">Apply</button>
        <button type="button" id="todayBtn" class="btn">Today</button>
        <button type="button" id="refreshOddsBtn" class="btn" title="Refresh odds for this date">Refresh Odds</button>
  <label class="control-label">Show results <input type="checkbox" id="resultsToggle" /></label>
  <label class="control-label">Hide odds <input type="checkbox" id="hideOdds" /></label>
        <a class="btn" href="/web/recommendations.html">Recommendations</a>
        <a class="btn" href="/web/props.html">Props</a>
        <a class="btn" href="/web/reconciliation.html">Reconciliation</a>
        <a class="btn" href="/web/odds_coverage.html">Odds Coverage</a>
      </form>
      <div class="hb-wrap">
        <div class="hb-dot" id="hbDot" title="Live polling active"></div>
        <div id="last-sb" class="last-sb" title="Last scoreboard poll (client clock)">—</div>
      </div>
    </div>
  </header>
  <main>
    <div class="container">
  <div id="note" class="alert hidden"></div>
      <div id="cards" class="cards"></div>
    </div>
  </main>
  <footer>
    <div class="container footer-meta">
      <span id="cronMeta">Odds cron: —</span>
    </div>
  </footer>
  <script src="/web/app.js"></script>
  <script>
    // Persist admin key for refresh endpoint (optional)
    (function(){
      const saved = sessionStorage.getItem('ADMIN_KEY') || '';
      if (!document.getElementById('adminKey')) return;
      const el = document.getElementById('adminKey');
      if (saved) el.value = saved;
      el.addEventListener('change', ()=> sessionStorage.setItem('ADMIN_KEY', el.value || ''));
    })();
    // Fetch cron meta and display in footer
    (async function(){
      try{
        const r = await fetch('/api/cron/meta');
        if (!r.ok) return;
        const j = await r.json();
        const el = document.getElementById('cronMeta');
        if (!el) return;
        let txt = 'Odds cron: —';
        const last = j && (j.last_refresh_bovada || null);
        if (last && last.timestamp){
          txt = `Odds cron: ${new Date(last.timestamp).toLocaleString()}${last.date?` (date ${last.date})`:''}`;
        } else if (j && j.fallback_odds_latest && j.fallback_odds_latest.mtime){
          txt = `Odds file: ${new Date(j.fallback_odds_latest.mtime).toLocaleString()}`;
        }
        el.textContent = txt;
      }catch(_){ /* ignore */ }
    })();
  </script>
</body>
</html>
